!function(t){window.Skyline.TimePicker=function(i,e){this.id=Skyline.guid(),this.el=i,this.$el=t(i),this.options=t.extend(window.Skyline.TimePicker._defaults,e),this.$modalEl=t(window.Skyline.TimePicker._template),this.modalEl=this.$modalEl[0],this.modalEl.id="modal-"+this.id,this.options.container?this.$modalEl.appendTo(this.options.container):this.$modalEl.insertBefore(this.el),this.formats={g:t=>t.getHours(),h:t=>{let i=t.getHours()%12;return 0===i?12:i},H:t=>{let i=t.getHours()%12;return i=0===i?12:i,(i<10?"0":"")+i},G:t=>{let i=t.getHours();return(i<10?"0":"")+i},m:t=>{let i=t.getMinutes();return(i<10?"0":"")+i},s:t=>{let i=t.getSeconds();return(i<10?"0":"")+i},a:t=>t.getHours()>11?"pm":"am",A:t=>t.getHours()>11?"PM":"AM"};var s={_handleInputClick:function(){this.options.autoOpen&&this.open()},_handleInputKeydown:function(t){t.which===Skyline.keys.ENTER&&this.options.autoOpen&&(t.preventDefault(),this.open())},_handleClockClickStart:function(t){t.preventDefault();let i=this.plate.getBoundingClientRect(),e=i.left,s=i.top;this.x0=e+this.options.dialRadius,this.y0=s+this.options.dialRadius,this.moved=!1;let n=window.Skyline.TimePicker._Pos(t);this.dx=n.x-this.x0,this.dy=n.y-this.y0,this.setHand(this.dx,this.dy,!1),document.addEventListener("mousemove",this._handleDocumentClickMoveBound),document.addEventListener("touchmove",this._handleDocumentClickMoveBound),document.addEventListener("mouseup",this._handleDocumentClickEndBound),document.addEventListener("touchend",this._handleDocumentClickEndBound)},_handleDocumentClickMove:function(t){t.preventDefault();let i=window.Skyline.TimePicker._Pos(t),e=i.x-this.x0,s=i.y-this.y0;this.moved=!0,this.setHand(e,s,!1,!0)},_handleDocumentClickEnd:function(i){i.preventDefault(),document.removeEventListener("mouseup",this._handleDocumentClickEndBound),document.removeEventListener("touchend",this._handleDocumentClickEndBound);let e=window.Skyline.TimePicker._Pos(i),s=e.x-this.x0,n=e.y-this.y0;this.moved&&s===this.dx&&n===this.dy&&this.setHand(s,n),"hours"===this.currentView?this.showView("minutes",this.options.duration/2):this.options.autoClose&&(t(this.minutesView).addClass("timepicker-dial-out"),setTimeout(()=>{this.done()},this.options.duration/2)),"function"==typeof this.options.onSelect&&this.options.onSelect.call(this,this.hours,this.minutes),document.removeEventListener("mousemove",this._handleDocumentClickMoveBound),document.removeEventListener("touchmove",this._handleDocumentClickMoveBound)}},n=this;this.$modalEl.on("show.bs.modal",this.options.onOpenStart).on("shown.bs.modal",this.options.onOpenEnd).on("hide.bs.modal",this.options.onCloseStart).on("hidden.bs.modal",(function(){"function"==typeof n.options.onCloseEnd&&n.options.onCloseEnd.call(this),n.isOpen=!1})),this._get24Hours=function(){let t=n.hours;return n.options.twelveHour&&("PM"===n.amOrPm&&(t+=12),"AM"===n.amOrPm&&12===t&&(t=0)),t},this._mirror=function(){n.options.mirror&&n.options.mirrorFormat&&t(n.options.mirror).val(n.formatDate(new Date(2e3,1,1,n._get24Hours(),n.minutes),n.options.mirrorFormat))},this.currentView="hours",this.vibrate=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,this._canvas=this.modalEl.querySelector(".timepicker-canvas"),this.plate=this.modalEl.querySelector(".timepicker-plate"),this.hoursView=this.modalEl.querySelector(".timepicker-hours"),this.minutesView=this.modalEl.querySelector(".timepicker-minutes"),this.spanHours=this.modalEl.querySelector(".timepicker-span-hours"),this.spanMinutes=this.modalEl.querySelector(".timepicker-span-minutes"),this.spanAmPm=this.modalEl.querySelector(".timepicker-span-am-pm"),this.footer=this.modalEl.querySelector(".timepicker-footer"),this.amOrPm="PM",this._handleInputKeydownBound=s._handleInputKeydown.bind(this),this._handleInputClickBound=s._handleInputClick.bind(this),this._handleClockClickStartBound=s._handleClockClickStart.bind(this),this._handleDocumentClickMoveBound=s._handleDocumentClickMove.bind(this),this._handleDocumentClickEndBound=s._handleDocumentClickEnd.bind(this),this.el.addEventListener("click",this._handleInputClickBound),this.el.addEventListener("keydown",this._handleInputKeydownBound),this.plate.addEventListener("mousedown",this._handleClockClickStartBound),this.plate.addEventListener("touchstart",this._handleClockClickStartBound),this.showView=function(i,e){"minutes"===i&&t(this.hoursView).css("visibility");let s="hours"===i,n=s?this.hoursView:this.minutesView,o=s?this.minutesView:this.hoursView;this.currentView=i,t(this.spanHours).toggleClass("text-active",s),t(this.spanMinutes).toggleClass("text-active",!s),o.classList.add("timepicker-dial-out"),t(n).css("visibility","visible").removeClass("timepicker-dial-out"),this.resetClock(e),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(()=>{t(o).css("visibility","hidden")},this.options.duration)},t(this.spanHours).on("click",this.showView.bind(this,"hours")),t(this.spanMinutes).on("click",this.showView.bind(this,"minutes")),this._handleAmPmClick=function(i){let e=t(i.target);this.amOrPm=e.hasClass("am-btn")?"AM":"PM",this._updateAmPmView()},this.options.twelveHour&&(this.$amBtn=t('<div class="am-btn">AM</div>'),this.$pmBtn=t('<div class="pm-btn">PM</div>'),this.$amBtn.on("click",this._handleAmPmClick.bind(this)).appendTo(this.spanAmPm),this.$pmBtn.on("click",this._handleAmPmClick.bind(this)).appendTo(this.spanAmPm)),this._updateAmPmView=function(){this.options.twelveHour&&(this.$amBtn.toggleClass("text-active","AM"===this.amOrPm),this.$pmBtn.toggleClass("text-active","PM"===this.amOrPm))},this._updateTimeFromInput=function(){this.hours=this.minutes=-1;let t=this;((this.el.value||this.options.defaultTime||"")+"").split(/(\d+|AM|PM)/gi).forEach((function(i){var e=1*i;if("now"===i.toLowerCase()){let i=new Date(+new Date+t.options.fromNow);return value=[i.getHours(),i.getMinutes()],t.options.twelveHour&&(t.amOrPm=value[0]>=12&&value[0]<24?"PM":"AM"),t.hours=i.getHours(),void(t.minutes=i.getMinutes())}return"am"===i.toLowerCase()&&(t.hours=t.hours%12,t.options.twelveHour)?(0===t.hours&&(t.hours=12),void(t.amOrPm="AM")):"pm"===i.toLowerCase()?(t.hours=t.hours%12+12,0===t.hours&&(t.hours=12),void(t.amOrPm="PM")):isNaN(e)||""===i?void 0:-1===t.hours?(e>12?t.amOrPm="PM":e<12||t.options.twelveHour?t.amOrPm="AM":t.amOrPm="PM",t.options.twelveHour&&0===e&&(e=12),t.hours=e):-1===t.minutes?(t.options.twelveHour&&0===e&&(e=12),t.minutes=e):void 0})),this.spanHours.innerHTML=this.hours,this.spanMinutes.innerHTML=window.Skyline.TimePicker._addLeadingZero(this.minutes),this._mirror(),this._updateAmPmView(),this.options.autoUpdate&&(this.el.value=this.formatDate(new Date(2e3,1,1,this._get24Hours(),this.minutes),this.options.format))},this._buildSVGClock=function(){let t=this.options.dialRadius,i=this.options.tickRadius,e=2*t,s=window.Skyline.TimePicker._createSVGEl("svg");s.setAttribute("class","timepicker-svg"),s.setAttribute("width",e),s.setAttribute("height",e);let n=window.Skyline.TimePicker._createSVGEl("g");n.setAttribute("transform","translate("+t+","+t+")");let o=window.Skyline.TimePicker._createSVGEl("circle");o.setAttribute("class","timepicker-canvas-bearing"),o.setAttribute("cx",0),o.setAttribute("cy",0),o.setAttribute("r",4);let a=window.Skyline.TimePicker._createSVGEl("line");a.setAttribute("x1",0),a.setAttribute("y1",0);let h=window.Skyline.TimePicker._createSVGEl("circle");h.setAttribute("class","timepicker-canvas-bg"),h.setAttribute("r",i),n.appendChild(a),n.appendChild(h),n.appendChild(o),s.appendChild(n),this._canvas.appendChild(s),this.hand=a,this.bg=h,this.bearing=o,this.g=n},this._buildHoursView=function(){let i=t('<div class="timepicker-tick"></div>');if(this.options.twelveHour)for(let t=1;t<13;t+=1){let e=i.clone(),s=t/6*Math.PI,n=this.options.outerRadius;e.css({left:this.options.dialRadius+Math.sin(s)*n-this.options.tickRadius+"px",top:this.options.dialRadius-Math.cos(s)*n-this.options.tickRadius+"px"}),e.html(0===t?"00":t),this.hoursView.appendChild(e[0])}else for(let t=0;t<24;t+=1){let e=i.clone(),s=t/6*Math.PI,n=t>0&&t<13?this.options.innerRadius:this.options.outerRadius;e.css({left:this.options.dialRadius+Math.sin(s)*n-this.options.tickRadius+"px",top:this.options.dialRadius-Math.cos(s)*n-this.options.tickRadius+"px"}),e.html(0===t?"00":t),this.hoursView.appendChild(e[0])}},this._buildMinutesView=function(){let i=t('<div class="timepicker-tick"></div>');for(let t=0;t<60;t+=5){let e=i.clone(),s=t/30*Math.PI;e.css({left:this.options.dialRadius+Math.sin(s)*this.options.outerRadius-this.options.tickRadius+"px",top:this.options.dialRadius-Math.cos(s)*this.options.outerRadius-this.options.tickRadius+"px"}),e.html(window.Skyline.TimePicker._addLeadingZero(t)),this.minutesView.appendChild(e[0])}},this.resetClock=function(i){let e=this.currentView,s=this[e],n="hours"===e,o=s*(Math.PI/(n?6:30)),a=n&&s>0&&s<13?this.options.innerRadius:this.options.outerRadius,h=Math.sin(o)*a,l=-Math.cos(o)*a,r=this;i?(t(this.canvas).addClass("timepicker-canvas-out"),setTimeout(()=>{t(r.canvas).removeClass("timepicker-canvas-out"),r.setHand(h,l)},i)):this.setHand(h,l)},this.setHand=function(t,i,e){let s=Math.atan2(t,-i),n="hours"===this.currentView,o=Math.PI/(n||e?6:30),a=Math.sqrt(t*t+i*i),h=n&&a<(this.options.outerRadius+this.options.innerRadius)/2,l=h?this.options.innerRadius:this.options.outerRadius;this.options.twelveHour&&(l=this.options.outerRadius),s<0&&(s=2*Math.PI+s);let r=Math.round(s/o);s=r*o,this.options.twelveHour?n?0===r&&(r=12):(e&&(r*=5),60===r&&(r=0)):n?(12===r&&(r=0),r=h?0===r?12:r:0===r?0:r+12):(e&&(r*=5),60===r&&(r=0)),this[this.currentView]!==r&&this.vibrate&&this.options.vibrate&&(this.vibrateTimer||(navigator[this.vibrate](10),this.vibrateTimer=setTimeout(()=>{this.vibrateTimer=null},100))),this[this.currentView]=r,n?this.spanHours.innerHTML=r:this.spanMinutes.innerHTML=window.Skyline.TimePicker._addLeadingZero(r);let d=Math.sin(s)*(l-this.options.tickRadius),u=-Math.cos(s)*(l-this.options.tickRadius),c=Math.sin(s)*l,m=-Math.cos(s)*l;this.hand.setAttribute("x2",d),this.hand.setAttribute("y2",u),this.bg.setAttribute("cx",c),this.bg.setAttribute("cy",m)},this.open=function(){this.isOpen||(this.isOpen=!0,this._updateTimeFromInput(),this.showView("hours"),this.$modalEl.modal("show"))},this.close=function(){this.isOpen&&(this.isOpen=!1,this.$modalEl.modal("hide"))},this.formatDate=function(t,i){return i.split(/(h|m|s|a|g)/gi).map(i=>this.formats[i]?this.formats[i](t):i).join("")},this.done=function(t,i){let e=this.el.value;this.el.value=this.formatDate(new Date(2e3,1,1,this._get24Hours(),this.minutes),this.options.format),this._mirror(),this.el.value!==e&&this.$el.trigger("change"),this.close(),this.el.focus()},this.clear=function(){this.done(null,!0)},this._buildHoursView(),this._buildMinutesView(),this._buildSVGClock();let o=t(`<button class="btn-flat timepicker-clear waves-effect" style="visibility: hidden;" type="button" tabindex="${this.options.twelveHour?"3":"1"}">${this.options.i18n.clear}</button>`).appendTo(this.footer).on("click",this.clear.bind(this));this.options.showClearBtn&&o.css({visibility:""});let a=t('<div class="confirmation-btns"></div>');t('<button class="btn-flat timepicker-close waves-effect" type="button" tabindex="'+(this.options.twelveHour?"3":"1")+'">'+this.options.i18n.cancel+"</button>").appendTo(a).on("click",this.close.bind(this)),t('<button class="btn-flat timepicker-close waves-effect" type="button" tabindex="'+(this.options.twelveHour?"3":"1")+'">'+this.options.i18n.done+"</button>").appendTo(a).on("click",this.done.bind(this)),a.appendTo(this.footer),this._updateTimeFromInput(),this.el.addEventListener("change",this._updateTimeFromInput.bind(this),!0)},window.Skyline.TimePicker._defaults={dialRadius:135,outerRadius:105,innerRadius:70,tickRadius:20,duration:350,container:t(document.body),defaultTime:"now",fromNow:0,showClearBtn:!1,format:"h:mm",mirror:null,mirrorFormat:null,i18n:{cancel:"Cancel",clear:"Clear",done:"Ok"},autoOpen:!0,autoUpdate:!1,autoClose:!1,twelveHour:!1,vibrate:!0,onOpenStart:null,onOpenEnd:null,onCloseStart:null,onCloseEnd:null,onSelect:null},window.Skyline.TimePicker._addLeadingZero=function(t){return(t<10?"0":"")+t},window.Skyline.TimePicker._createSVGEl=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},window.Skyline.TimePicker._Pos=function(t){return t.targetTouches&&t.targetTouches.length>=1?{x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY}:{x:t.clientX,y:t.clientY}},window.Skyline.TimePicker._template=['<div class= "modal timepicker-modal fade" role="dialog">','<div class="modal-dialog" role="document">','<div class="modal-content timepicker-container">','<div class="timepicker-digital-display">','<div class="timepicker-text-container">','<div class="timepicker-display-column">','<span class="timepicker-span-hours"></span>',":",'<span class="timepicker-span-minutes"></span>',"</div>",'<div class="timepicker-display-column timepicker-display-am-pm">','<div class="timepicker-span-am-pm"></div>',"</div>","</div>","</div>",'<div class="timepicker-analog-display">','<div class="timepicker-plate">','<div class="timepicker-canvas"></div>','<div class="timepicker-dial timepicker-hours"></div>','<div class="timepicker-dial timepicker-minutes timepicker-dial-out"></div>',"</div>",'<div class="timepicker-footer"></div>',"</div>","</div>","</div>","</div>"].join(""),t.fn.timepicker=function(i,e){t(this).each((function(){this.Sky_Timepicker||(this.Sky_Timepicker=new window.Skyline.TimePicker(this,e))}));var s=this[0].Sky_Timepicker;return"open"==i&&s.open(),"instance"==i?s:("update"===i&&s._updateTimeFromInput(),this)}}(jQuery);
